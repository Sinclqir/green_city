(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{966:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(5155),a=r(2115),i=r(5695),l=r(6874),c=r.n(l),n=r(3384);let d=r(7358).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function o(){let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(!0),[o,x]=(0,a.useState)(null),h=(0,i.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token");if(!e){h.push("/login");return}(async()=>{try{let r=await fetch("".concat(d,"/users/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(!r.ok)throw Error("Auth error");if(!(await r.json()).is_admin){h.push("/");return}let s=await fetch("".concat(d,"/users/"),{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)throw Error("Failed to fetch users");let a=await s.json();t(a)}catch(e){x(e.message),"Auth error"===e.message&&h.push("/login")}finally{l(!1)}})()},[h]);let u=async e=>{if(!confirm("\xcates-vous s\xfbr de vouloir supprimer cet utilisateur et toutes ses id\xe9es ? Cette action est irr\xe9versible."))return;let r=localStorage.getItem("token");try{let s=await fetch("".concat(d,"/users/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});if(s.ok)t(t=>t.filter(t=>t.id!==e)),alert("Utilisateur et ses id\xe9es supprim\xe9s avec succ\xe8s.");else{let e=await s.json();throw Error(e.detail||"\xc9chec de la suppression de l'utilisateur.")}}catch(e){alert("Erreur: "+e.message)}};return r?(0,s.jsx)("div",{className:"text-center mt-10",children:"Chargement du tableau de bord..."}):o?(0,s.jsxs)("div",{className:"text-center mt-10 text-red-500",children:["Erreur: ",o]}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:(0,s.jsx)(c(),{href:"/",passHref:!0,children:(0,s.jsx)("div",{className:"flex items-center cursor-pointer",children:(0,s.jsxs)("h1",{className:"text-2xl font-bold",children:["Green",(0,s.jsx)("span",{className:"text-green-500",children:"City"}),(0,s.jsx)("span",{className:"inline-flex ml-1",children:(0,s.jsx)(n.A,{className:"h-5 w-5 text-green-500 fill-green-500"})})]})})})})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Tableau de bord administrateur"}),(0,s.jsx)("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full leading-normal",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ID"}),(0,s.jsx)("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Nom"}),(0,s.jsx)("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"R\xf4le"}),(0,s.jsx)("th",{className:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:(0,s.jsx)("p",{className:"text-gray-900 whitespace-no-wrap",children:e.id})}),(0,s.jsx)("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:(0,s.jsx)("p",{className:"text-gray-900 whitespace-no-wrap",children:e.email})}),(0,s.jsx)("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:(0,s.jsx)("p",{className:"text-gray-900 whitespace-no-wrap",children:e.name||"N/A"})}),(0,s.jsx)("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(e.is_admin?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:e.is_admin?"Admin":"Utilisateur"})}),(0,s.jsx)("td",{className:"px-5 py-5 border-b border-gray-200 bg-white text-sm",children:!e.is_admin&&(0,s.jsx)("button",{onClick:()=>u(e.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors",children:"Supprimer l'utilisateur"})})]},e.id))})]})})]})]})}},3384:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]])},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},8036:(e,t,r)=>{Promise.resolve().then(r.bind(r,966))}},e=>{var t=t=>e(e.s=t);e.O(0,[95,441,684,358],()=>t(8036)),_N_E=e.O()}]);