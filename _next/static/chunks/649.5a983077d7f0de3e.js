"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{2649:(t,i,e)=>{e.r(i),e.d(i,{CityBuilder:()=>E});var o=e(5155),s=e(2115),a=e(3962),n=e(4958),r=e(2136),l=e(4688),d=e(8842),c=e(681);function p(t){let{position:i,rotation:e,isPreview:a=!1}=t,n=(0,s.useRef)(null);return(0,c.F)(t=>{if(n.current&&!a){let i=t.clock.getElapsedTime();n.current.rotation.x=.02*Math.sin(.5*i),n.current.rotation.z=.02*Math.cos(.3*i)}}),(0,o.jsxs)("group",{ref:n,position:i,rotation:e,children:[(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.75,0],children:[(0,o.jsx)("cylinderGeometry",{args:[.1,.2,1.5,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#8B4513"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1.75,0],children:[(0,o.jsx)("coneGeometry",{args:[.8,2,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#2e7d32",opacity:a?.5:1,transparent:a})]})]})}function h(t){let{position:i,rotation:e,isPreview:a=!1}=t,n=(0,s.useRef)(null);return(0,c.F)(t=>{if(n.current&&!a){let i=t.clock.getElapsedTime();n.current.rotation.x=-Math.PI/4+.05*Math.sin(.1*i)}}),(0,o.jsxs)("group",{ref:n,position:i,rotation:[...e],children:[(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.05,0],children:[(0,o.jsx)("boxGeometry",{args:[1.2,.1,1.2]}),(0,o.jsx)("meshStandardMaterial",{color:"#9E9E9E",opacity:a?.5:1,transparent:a})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.15,0],rotation:[-Math.PI/4,0,0],children:[(0,o.jsx)("boxGeometry",{args:[1.1,.05,1.1]}),(0,o.jsx)("meshStandardMaterial",{color:"#1A237E",opacity:a?.5:1,transparent:a,metalness:.8,roughness:.2})]}),(0,o.jsxs)("mesh",{position:[0,.17,0],rotation:[-Math.PI/4,0,0],children:[(0,o.jsx)("gridHelper",{args:[1.1,4,"#FFFFFF","#FFFFFF"]}),(0,o.jsx)("meshBasicMaterial",{opacity:a?.3:.6,transparent:!0})]})]})}function x(t){let{position:i,scale:e=[1,1,1],id:s,isHighlighted:a=!1,hasLights:n=!1}=t;return(0,o.jsxs)("group",{position:i,scale:e,children:[(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1,0],children:[(0,o.jsx)("boxGeometry",{args:[1.8,2,1.8]}),(0,o.jsx)("meshStandardMaterial",{color:a?"#4CAF50":"#9E9E9E"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,2.05,0],children:[(0,o.jsx)("boxGeometry",{args:[1.9,.1,1.9]}),(0,o.jsx)("meshStandardMaterial",{color:a?"#81C784":"#616161"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1,.91],children:[(0,o.jsx)("boxGeometry",{args:[1.4,1.4,.05]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#FFF59D":"#B3E5FC",opacity:.7,transparent:!0,emissive:n?"#FFF59D":"#000000",emissiveIntensity:.5*!!n})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1,-.91],children:[(0,o.jsx)("boxGeometry",{args:[1.4,1.4,.05]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#FFF59D":"#B3E5FC",opacity:.7,transparent:!0,emissive:n?"#FFF59D":"#000000",emissiveIntensity:.5*!!n})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[.91,1,0],children:[(0,o.jsx)("boxGeometry",{args:[.05,1.4,1.4]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#FFF59D":"#B3E5FC",opacity:.7,transparent:!0,emissive:n?"#FFF59D":"#000000",emissiveIntensity:.5*!!n})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[-.91,1,0],children:[(0,o.jsx)("boxGeometry",{args:[.05,1.4,1.4]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#FFF59D":"#B3E5FC",opacity:.7,transparent:!0,emissive:n?"#FFF59D":"#000000",emissiveIntensity:.5*!!n})]}),n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("pointLight",{position:[0,1,1],intensity:.5,color:"#FFF59D",distance:3}),(0,o.jsx)("pointLight",{position:[0,1,-1],intensity:.5,color:"#FFF59D",distance:3}),(0,o.jsx)("pointLight",{position:[1,1,0],intensity:.5,color:"#FFF59D",distance:3}),(0,o.jsx)("pointLight",{position:[-1,1,0],intensity:.5,color:"#FFF59D",distance:3})]})]})}function m(t){let{position:i,rotation:e}=t;return(0,o.jsxs)("group",{position:i,rotation:e,children:[(0,o.jsxs)("mesh",{receiveShadow:!0,position:[0,.01,0],children:[(0,o.jsx)("boxGeometry",{args:[2,.02,1]}),(0,o.jsx)("meshStandardMaterial",{color:"#424242"})]}),(0,o.jsxs)("mesh",{position:[0,.02,0],children:[(0,o.jsx)("boxGeometry",{args:[.8,.01,.1]}),(0,o.jsx)("meshStandardMaterial",{color:"white"})]})]})}function g(t){let{position:i,rotation:e,isNight:s=!1,id:a,isHighlighted:n=!1}=t;return(0,o.jsxs)("group",{position:i,rotation:e,className:"car",children:[(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.2,0],children:[(0,o.jsx)("boxGeometry",{args:[.8,.2,.4]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#4CAF50":"#E53935"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.35,0],children:[(0,o.jsx)("boxGeometry",{args:[.5,.15,.38]}),(0,o.jsx)("meshStandardMaterial",{color:n?"#81C784":"#C62828"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.35,.19],children:[(0,o.jsx)("boxGeometry",{args:[.48,.12,.01]}),(0,o.jsx)("meshStandardMaterial",{color:"#B3E5FC",opacity:.7,transparent:!0})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,.35,-.19],children:[(0,o.jsx)("boxGeometry",{args:[.48,.12,.01]}),(0,o.jsx)("meshStandardMaterial",{color:"#B3E5FC",opacity:.7,transparent:!0})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[.25,.1,.2],children:[(0,o.jsx)("cylinderGeometry",{args:[.1,.1,.05,16],rotation:[Math.PI/2,0,0]}),(0,o.jsx)("meshStandardMaterial",{color:"#212121"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[-.25,.1,.2],children:[(0,o.jsx)("cylinderGeometry",{args:[.1,.1,.05,16],rotation:[Math.PI/2,0,0]}),(0,o.jsx)("meshStandardMaterial",{color:"#212121"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[.25,.1,-.2],children:[(0,o.jsx)("cylinderGeometry",{args:[.1,.1,.05,16],rotation:[Math.PI/2,0,0]}),(0,o.jsx)("meshStandardMaterial",{color:"#212121"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[-.25,.1,-.2],children:[(0,o.jsx)("cylinderGeometry",{args:[.1,.1,.05,16],rotation:[Math.PI/2,0,0]}),(0,o.jsx)("meshStandardMaterial",{color:"#212121"})]}),s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("mesh",{position:[.4,.2,.15],rotation:[0,0,0],children:[(0,o.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#FFEB3B",emissive:"#FFEB3B",emissiveIntensity:1})]}),(0,o.jsxs)("mesh",{position:[.4,.2,-.15],rotation:[0,0,0],children:[(0,o.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#FFEB3B",emissive:"#FFEB3B",emissiveIntensity:1})]}),(0,o.jsx)("pointLight",{position:[.5,.2,0],intensity:.5,color:"#FFEB3B",distance:2})]}),s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("mesh",{position:[-.4,.2,.15],rotation:[0,0,0],children:[(0,o.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#F44336",emissive:"#F44336",emissiveIntensity:1})]}),(0,o.jsxs)("mesh",{position:[-.4,.2,-.15],rotation:[0,0,0],children:[(0,o.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#F44336",emissive:"#F44336",emissiveIntensity:1})]}),(0,o.jsx)("pointLight",{position:[-.5,.2,0],intensity:.3,color:"#F44336",distance:1})]}),n&&(0,o.jsxs)("mesh",{position:[0,.7,0],children:[(0,o.jsx)("sphereGeometry",{args:[.2,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#4CAF50",opacity:.3,transparent:!0})]})]})}function u(t){let{position:i,scale:e=[1,1,1],id:a,chimneyRemoved:n=!1,isHighlighted:r=!1,isNight:l=!1}=t,d=(0,s.useRef)(null);return(0,c.F)(t=>{if(d.current&&!n){let i=t.clock.getElapsedTime();d.current.children.forEach((t,e)=>{t.position.y+=.01,t.position.x+=.005*Math.sin(.5*i+e);let o=t.material;o.opacity-=.005,o.opacity<=0&&(t.position.y=0,o.opacity=.7)})}}),(0,o.jsxs)("group",{position:i,scale:e,children:[(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1,0],children:[(0,o.jsx)("boxGeometry",{args:[2,2,2]}),(0,o.jsx)("meshStandardMaterial",{color:r?"#ff9800":"#757575"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,2.05,0],children:[(0,o.jsx)("boxGeometry",{args:[2.1,.1,2.1]}),(0,o.jsx)("meshStandardMaterial",{color:"#424242"})]}),!n&&(0,o.jsxs)("mesh",{castShadow:!0,position:[.5,2.75,.5],children:[(0,o.jsx)("cylinderGeometry",{args:[.2,.3,1.5,8]}),(0,o.jsx)("meshStandardMaterial",{color:r?"#ff9800":"#616161"})]}),(0,o.jsxs)("mesh",{castShadow:!0,position:[0,1,1.01],children:[(0,o.jsx)("boxGeometry",{args:[1.6,1,.05]}),(0,o.jsx)("meshStandardMaterial",{color:l?"#FFF59D":"#B3E5FC",opacity:.7,transparent:!0,emissive:l?"#FFF59D":"#000000",emissiveIntensity:.3*!!l})]}),l&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("pointLight",{position:[0,1,1.2],intensity:.4,color:"#FFF59D",distance:3}),(0,o.jsx)("pointLight",{position:[.5,3,.5],intensity:.3,color:"#FF5722",distance:2,visible:!n})]}),!n&&(0,o.jsx)("group",{ref:d,position:[.5,3.5,.5],children:Array.from({length:10}).map((t,i)=>(0,o.jsxs)("mesh",{position:[0,.2*i,0],children:[(0,o.jsx)("sphereGeometry",{args:[.2,8,8]}),(0,o.jsx)("meshStandardMaterial",{color:"#9E9E9E",opacity:.7-.07*i,transparent:!0})]},i))})]})}function y(t){let{placedItems:i,selectedItem:e,onPlaceItem:a,gameStarted:n,isNight:r}=t,l=(0,s.useRef)(null),[d,y]=(0,s.useState)(null),[j,f]=(0,s.useState)(null),[b,M]=(0,s.useState)(null),F=[];for(let t=-6;t<6;t++)for(let i=-6;i<6;i++)F.push([2*t,0,2*i]);let S=(0,s.useMemo)(()=>[{type:"building",position:[-10,0,-10],scale:[1,1.5,1],id:"building-1"},{type:"building",position:[-10,0,-6],scale:[1,2,1],id:"building-2"},{type:"building",position:[-10,0,-2],scale:[1,1,1],id:"building-3"},{type:"building",position:[-10,0,2],scale:[1,1.8,1],id:"building-4"},{type:"building",position:[-6,0,-10],scale:[1,1.2,1],id:"building-5"},{type:"building",position:[-2,0,-10],scale:[1,1.7,1],id:"building-6"},{type:"building",position:[2,0,-10],scale:[1,1.3,1],id:"building-7"},{type:"building",position:[6,0,-10],scale:[1,1.5,1],id:"building-8"},{type:"building",position:[10,0,-10],scale:[1,2.2,1],id:"building-9"},{type:"building",position:[10,0,-6],scale:[1,1.6,1],id:"building-10"},{type:"building",position:[10,0,-2],scale:[1,1.4,1],id:"building-11"},{type:"building",position:[10,0,2],scale:[1,1.9,1],id:"building-12"},{type:"building",position:[10,0,6],scale:[1,1.3,1],id:"building-13"},{type:"building",position:[10,0,10],scale:[1,1.7,1],id:"building-14"},{type:"building",position:[6,0,10],scale:[1,1.3,1],id:"building-15"},{type:"building",position:[2,0,10],scale:[1,1.7,1],id:"building-16"},{type:"building",position:[-2,0,10],scale:[1,1.5,1],id:"building-17"},{type:"building",position:[-6,0,10],scale:[1,2.1,1],id:"building-18"},{type:"building",position:[-10,0,6],scale:[1,1.8,1],id:"building-19"},{type:"building",position:[-10,0,10],scale:[1,1.4,1],id:"building-20"},{type:"building",position:[0,0,4],scale:[1.2,2.5,1.2],id:"building-center-1",hasLights:!0},{type:"building",position:[-4,0,0],scale:[1.3,2.2,1.3],id:"building-center-2",hasLights:!0},{type:"building",position:[4,0,-4],scale:[1.4,2.8,1.4],id:"building-center-3",hasLights:!0},{type:"building",position:[0,0,-4],scale:[1.2,2,1.2],id:"building-center-4",hasLights:!0},{type:"building",position:[2,0,-2],scale:[1.1,1.8,1.1],id:"building-center-5",hasLights:!0},{type:"road",position:[-8,0,-8],rotation:[0,0,0],id:"road-1"},{type:"road",position:[-6,0,-8],rotation:[0,0,0],id:"road-2"},{type:"road",position:[-4,0,-8],rotation:[0,0,0],id:"road-3"},{type:"road",position:[-2,0,-8],rotation:[0,0,0],id:"road-4"},{type:"road",position:[0,0,-8],rotation:[0,0,0],id:"road-5"},{type:"road",position:[2,0,-8],rotation:[0,0,0],id:"road-6"},{type:"road",position:[4,0,-8],rotation:[0,0,0],id:"road-7"},{type:"road",position:[6,0,-8],rotation:[0,0,0],id:"road-8"},{type:"road",position:[8,0,-8],rotation:[0,0,0],id:"road-9"},{type:"road",position:[-8,0,-6],rotation:[0,Math.PI/2,0],id:"road-10"},{type:"road",position:[-8,0,-4],rotation:[0,Math.PI/2,0],id:"road-11"},{type:"road",position:[-8,0,-2],rotation:[0,Math.PI/2,0],id:"road-12"},{type:"road",position:[-8,0,0],rotation:[0,Math.PI/2,0],id:"road-13"},{type:"road",position:[-8,0,2],rotation:[0,Math.PI/2,0],id:"road-14"},{type:"road",position:[-8,0,4],rotation:[0,Math.PI/2,0],id:"road-15"},{type:"road",position:[-8,0,6],rotation:[0,Math.PI/2,0],id:"road-16"},{type:"road",position:[-8,0,8],rotation:[0,Math.PI/2,0],id:"road-17"},{type:"road",position:[-8,0,8],rotation:[0,0,0],id:"road-18"},{type:"road",position:[-6,0,8],rotation:[0,0,0],id:"road-19"},{type:"road",position:[-4,0,8],rotation:[0,0,0],id:"road-20"},{type:"road",position:[-2,0,8],rotation:[0,0,0],id:"road-21"},{type:"road",position:[0,0,8],rotation:[0,0,0],id:"road-22"},{type:"road",position:[2,0,8],rotation:[0,0,0],id:"road-23"},{type:"road",position:[4,0,8],rotation:[0,0,0],id:"road-24"},{type:"road",position:[6,0,8],rotation:[0,0,0],id:"road-25"},{type:"road",position:[8,0,8],rotation:[0,0,0],id:"road-26"},{type:"road",position:[8,0,-6],rotation:[0,Math.PI/2,0],id:"road-27"},{type:"road",position:[8,0,-4],rotation:[0,Math.PI/2,0],id:"road-28"},{type:"road",position:[8,0,-2],rotation:[0,Math.PI/2,0],id:"road-29"},{type:"road",position:[8,0,0],rotation:[0,Math.PI/2,0],id:"road-30"},{type:"road",position:[8,0,2],rotation:[0,Math.PI/2,0],id:"road-31"},{type:"road",position:[8,0,4],rotation:[0,Math.PI/2,0],id:"road-32"},{type:"road",position:[8,0,6],rotation:[0,Math.PI/2,0],id:"road-33"},{type:"road",position:[-8,0,-8],rotation:[0,0,0],id:"corner-1"},{type:"road",position:[8,0,-8],rotation:[0,0,0],id:"corner-2"},{type:"road",position:[8,0,8],rotation:[0,0,0],id:"corner-3"},{type:"road",position:[-8,0,8],rotation:[0,0,0],id:"corner-4"},{type:"factory",position:[0,0,0],scale:[1.5,1.5,1.5],id:"factory-1"},{type:"factory",position:[4,0,2],scale:[1.2,1.2,1.2],id:"factory-2"},{type:"factory",position:[-4,0,4],scale:[1.3,1.3,1.3],id:"factory-3"},{type:"factory",position:[-2,0,-2],scale:[1.2,1.2,1.2],id:"factory-5"},{type:"car",position:[-6,.1,-8],rotation:[0,0,0],id:"car-1"},{type:"car",position:[2,.1,-8],rotation:[0,0,0],id:"car-2"},{type:"car",position:[-8,.1,2],rotation:[0,Math.PI/2,0],id:"car-3"},{type:"car",position:[8,.1,-4],rotation:[0,Math.PI/2,0],id:"car-4"},{type:"car",position:[4,.1,8],rotation:[0,Math.PI,0],id:"car-5"},{type:"car",position:[-4,.1,8],rotation:[0,Math.PI,0],id:"car-6"},{type:"car",position:[8,.1,4],rotation:[0,Math.PI/2,0],id:"car-7"},{type:"car",position:[-8,.1,-4],rotation:[0,Math.PI/2,0],id:"car-8"}],[]);(0,s.useMemo)(()=>S.filter(t=>"building"===t.type).map(t=>t.id),[S]),(0,s.useMemo)(()=>S.filter(t=>"factory"===t.type).map(t=>t.id),[S]);let v=t=>i.some(i=>"remove-chimney"===i.type&&i.targetId===t),w=t=>i.some(i=>"solar-panel"===i.type&&i.targetId===t),I=t=>i.some(i=>"turn-off-lights"===i.type&&i.targetId===t),N=(t,e)=>i.some(i=>{if("solar-panel"===i.type||"remove-chimney"===i.type||"turn-off-lights"===i.type)return!1;let[o,s,a]=i.position;return .5>Math.abs(o-t)&&.5>Math.abs(a-e)}),P=(t,i)=>S.find(e=>"building"===e.type&&1.5>Math.abs(e.position[0]-t)&&1.5>Math.abs(e.position[2]-i)),E=(t,i)=>S.find(e=>"factory"===e.type&&1.5>Math.abs(e.position[0]-t)&&1.5>Math.abs(e.position[2]-i));return(0,c.F)(t=>{let i=t.clock.getElapsedTime();document.querySelectorAll(".car").forEach((t,e)=>{t&&t.position&&(e%4==0?(t.position.x=-6+12*Math.sin(.5*i),t.position.z=-8,t.rotation.y=t.position.x>0?Math.PI:0):e%4==1?(t.position.z=-4+10*Math.sin(.4*i),t.position.x=8,t.rotation.y=t.position.z>0?1.5*Math.PI:.5*Math.PI):e%4==2?(t.position.x=4-10*Math.sin(.3*i),t.position.z=8,t.rotation.y=t.position.x<0?0:Math.PI):(t.position.z=2-8*Math.sin(.45*i),t.position.x=-8,t.rotation.y=t.position.z<0?.5*Math.PI:1.5*Math.PI))})}),(0,o.jsxs)("group",{ref:l,onPointerMove:t=>{if(!e||!n)return;t.stopPropagation();let{point:i}=t;if(y([2*Math.round(i.x/2),2*Math.round(i.z/2)]),"solar-panel"===e){let t=P(i.x,i.z);f((null==t?void 0:t.id)||null),M(null)}else if("remove-chimney"===e){let t=E(i.x,i.z);M((null==t?void 0:t.id)||null),f(null)}else if("turn-off-lights"===e&&r){let t=P(i.x,i.z);t&&t.hasLights&&!I(t.id)?f(t.id):f(null),M(null)}else f(null),M(null)},onClick:t=>{if(!e||!n)return;t.stopPropagation();let{point:i}=t;if("solar-panel"===e&&j){if(w(j))return;let t=S.find(t=>t.id===j);if(t){let i=t.scale?2*t.scale[1]:2;a([t.position[0],t.position[1]+i,t.position[2]],[0,0,0],j)}return}if("remove-chimney"===e&&b){if(v(b))return;let t=S.find(t=>t.id===b);t&&a([t.position[0],t.position[1],t.position[2]],[0,0,0],b);return}if("turn-off-lights"===e&&j&&r){if(I(j))return;let t=S.find(t=>t.id===j);t&&t.hasLights&&a([t.position[0],t.position[1],t.position[2]],[0,0,0],j);return}if(d){let[t,i]=d;if(N(t,i))return;a([t,0,i],[0,0,0])}},children:[(0,o.jsxs)("mesh",{receiveShadow:!0,rotation:[-Math.PI/2,0,0],position:[0,-.01,0],children:[(0,o.jsx)("planeGeometry",{args:[24,24]}),(0,o.jsx)("meshStandardMaterial",{color:"#8d8d8d"})]}),F.map((t,i)=>{let[e,s,a]=t;return(0,o.jsxs)("mesh",{position:[e,s,a],visible:!1,children:[(0,o.jsx)("boxGeometry",{args:[2,.1,2]}),(0,o.jsx)("meshBasicMaterial",{color:"white",transparent:!0,opacity:.1})]},i)}),S.map(t=>{if("building"===t.type){let i=t.hasLights&&r&&!I(t.id),s=j===t.id&&"solar-panel"===e&&!w(t.id)||j===t.id&&"turn-off-lights"===e&&i;return(0,o.jsx)(x,{id:t.id,position:t.position,scale:t.scale,isHighlighted:s,hasLights:i},t.id)}if("road"===t.type)return(0,o.jsx)(m,{position:t.position,rotation:t.rotation},t.id);if("factory"===t.type){let i=v(t.id);return(0,o.jsx)(u,{id:t.id,position:t.position,scale:t.scale,chimneyRemoved:i,isHighlighted:b===t.id&&"remove-chimney"===e&&!i,isNight:r},t.id)}return"car"===t.type?(0,o.jsx)(g,{position:t.position,rotation:t.rotation,isNight:r},t.id):null}),i.map(t=>{switch(t.type){case"tree":return(0,o.jsx)(p,{position:t.position,rotation:t.rotation},t.id);case"solar-panel":if(!S.find(i=>i.id===t.targetId))return null;return(0,o.jsx)(h,{position:t.position,rotation:t.rotation},t.id);default:return null}}),e&&d&&"solar-panel"!==e&&"remove-chimney"!==e&&"turn-off-lights"!==e&&(0,o.jsx)("group",{position:[d[0],0,d[1]],opacity:.5,children:"tree"===e&&(0,o.jsx)(p,{position:[0,0,0],rotation:[0,0,0],isPreview:!0})}),"solar-panel"===e&&j&&!w(j)&&(()=>{let t=S.find(t=>t.id===j);if(!t)return null;let i=t.scale?2*t.scale[1]:2;return(0,o.jsx)(h,{position:[t.position[0],t.position[1]+i,t.position[2]],rotation:[0,0,0],isPreview:!0})})()]})}var j=e(4267),f=e(3384),b=e(2098),M=e(4416),F=e(3799);function S(t){let{selectedItem:i,onItemSelect:e,gameStarted:s,gameOver:a,onStartGame:n,onResetGame:r,isNightMode:l}=t;return(0,o.jsx)("div",{className:"absolute bottom-4 left-4 right-4 bg-white p-4 rounded-lg shadow-lg",children:s?a?(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)(j.$,{onClick:r,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-2",children:"Rejouer"})}):(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold",children:"\xc9l\xe9ments \xe9cologiques"}),(0,o.jsx)("div",{className:"text-sm text-gray-500",children:"S\xe9lectionnez un \xe9l\xe9ment puis cliquez sur la grille pour le placer"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[(0,o.jsxs)(j.$,{onClick:()=>e("tree"),className:"flex flex-col items-center justify-center p-2 h-auto ".concat("tree"===i?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,o.jsx)(f.A,{className:"h-6 w-6 mb-1"}),(0,o.jsx)("span",{className:"text-xs",children:"Arbre"}),(0,o.jsx)("span",{className:"text-xs text-green-700 font-semibold",children:"+5% O₂"})]}),(0,o.jsxs)(j.$,{onClick:()=>e("solar-panel"),className:"flex flex-col items-center justify-center p-2 h-auto ".concat("solar-panel"===i?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,o.jsx)(b.A,{className:"h-6 w-6 mb-1"}),(0,o.jsx)("span",{className:"text-xs",children:"Panneau solaire"}),(0,o.jsx)("span",{className:"text-xs text-green-700 font-semibold",children:"+7% \xe9nergie"})]}),(0,o.jsxs)(j.$,{onClick:()=>e("remove-chimney"),className:"flex flex-col items-center justify-center p-2 h-auto ".concat("remove-chimney"===i?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,o.jsx)(M.A,{className:"h-6 w-6 mb-1"}),(0,o.jsx)("span",{className:"text-xs",children:"Retirer chemin\xe9e"}),(0,o.jsx)("span",{className:"text-xs text-green-700 font-semibold",children:"-12% CO₂"})]}),(0,o.jsxs)(j.$,{onClick:()=>e("turn-off-lights"),disabled:!l,className:"flex flex-col items-center justify-center p-2 h-auto ".concat("turn-off-lights"===i?"bg-green-500 text-white":l?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[(0,o.jsx)(F.A,{className:"h-6 w-6 mb-1"}),(0,o.jsx)("span",{className:"text-xs",children:"\xc9teindre lumi\xe8res"}),(0,o.jsx)("span",{className:"text-xs text-green-700 font-semibold",children:"+4% \xe9conomie"})]})]})]}):(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Construis ta ville verte"}),(0,o.jsx)("p",{className:"mb-4 text-gray-600",children:"Transforme cette ville pollu\xe9e en un espace \xe9cologique en ajoutant des \xe9l\xe9ments verts."}),(0,o.jsx)(j.$,{onClick:n,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-2",children:"Commencer"})]})})}function v(t){let{score:i,targetScore:e}=t,s=i/e*100;return(0,o.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-md w-64",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,o.jsx)("span",{className:"text-sm font-medium",children:"Score vert"}),(0,o.jsxs)("span",{className:"text-sm font-medium",children:[i,"/",e]})]}),(0,o.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,o.jsx)("div",{className:"bg-green-500 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(s,"%")}})})]})}function w(t){let{timeLeft:i}=t;return(0,o.jsx)("div",{className:"bg-white p-2 rounded-lg shadow-md",children:(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,o.jsx)("span",{className:"text-lg font-bold ".concat(i>60?"text-green-500":i>30?"text-yellow-500":"text-red-500"),children:(t=>{let i=Math.floor(t/60);return"".concat(i.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})(i)})]})})}var I=e(3509);function N(t){let{isNight:i,onToggle:e,disabled:s=!1}=t;return(0,o.jsx)(j.$,{onClick:e,disabled:s,className:"flex items-center space-x-2 w-64 ".concat(i?"bg-indigo-900 hover:bg-indigo-800 text-white":"bg-blue-400 hover:bg-blue-500 text-white"),children:i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(b.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{children:"Mode jour"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(I.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{children:"Mode nuit"})]})})}let P={tree:5,"solar-panel":7,"remove-chimney":12,"turn-off-lights":4};function E(){let[t,i]=(0,s.useState)(null),[e,c]=(0,s.useState)([]),[p,h]=(0,s.useState)(0),[x,m]=(0,s.useState)(120),[g,u]=(0,s.useState)(!1),[j,f]=(0,s.useState)(!1),[b,M]=(0,s.useState)(!1),[F,I]=(0,s.useState)(!1),E=(0,s.useRef)(null);return(0,s.useEffect)(()=>(g&&!j&&(E.current=setInterval(()=>{m(t=>t<=1?(clearInterval(E.current),f(!0),M(p>=100),0):t-1)},1e3)),()=>{E.current&&clearInterval(E.current)}),[g,j,p]),(0,s.useEffect)(()=>{p>=100&&g&&!j&&(f(!0),M(!0),E.current&&clearInterval(E.current))},[p,g,j]),(0,o.jsxs)("div",{className:"w-full h-[700px] relative bg-gray-100 rounded-lg overflow-hidden shadow-lg",children:[(0,o.jsx)(a.Hl,{shadows:!0,camera:{position:[20,20,20],fov:50},children:(0,o.jsxs)(s.Suspense,{fallback:null,children:[(0,o.jsx)(n.m,{sunPosition:F?[0,-10,0]:[10,10,0]}),(0,o.jsx)("ambientLight",{intensity:F?.1:.5}),(0,o.jsx)("directionalLight",{castShadow:!0,position:F?[0,-10,0]:[10,10,0],intensity:F?.2:1.5,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,o.jsx)(r.OH,{preset:F?"night":"city"}),(0,o.jsx)(y,{placedItems:e,selectedItem:t,onPlaceItem:(e,o,s)=>{if(!t||!g||j)return;let a={type:t,position:e,rotation:o,id:"".concat(t,"-").concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),targetId:s};c(t=>[...t,a]),h(i=>Math.min(i+P[t],100)),i(null)},gameStarted:g,isNight:F}),(0,o.jsx)(l.N,{enablePan:!0,enableZoom:!0,enableRotate:!0,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.5,minDistance:10,maxDistance:40}),j&&(0,o.jsx)(d.E,{position:[0,10,0],fontSize:2,color:b?"#22c55e":"#ef4444",anchorX:"center",anchorY:"middle",children:b?"Ville verte construite !":"Temps \xe9coul\xe9 !"})]})}),(0,o.jsxs)("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,o.jsx)(v,{score:p,targetScore:100}),(0,o.jsx)(N,{isNight:F,onToggle:()=>{I(t=>!t)},disabled:!g||j})]}),(0,o.jsx)(w,{timeLeft:x})]}),(0,o.jsx)(S,{selectedItem:t,onItemSelect:t=>{i(t)},gameStarted:g,gameOver:j,onStartGame:()=>{u(!0),f(!1),M(!1),h(0),m(120),c([])},onResetGame:()=>{u(!1),f(!1),M(!1),h(0),m(120),c([]),i(null),I(!1)},isNightMode:F})]})}}}]);